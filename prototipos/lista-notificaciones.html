<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SGAFCR · Notificaciones (Ver más)</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: { brand1:'#005C97', brand2:'#004a7c', line:'#e8eef5', muted:'#f9fafb', ink:'#2c3e50' },
          boxShadow: { card:'0 8px 32px rgba(0,0,0,.08)', panel:'0 10px 30px rgba(0,0,0,.15)' }
        }
      }
    }
  </script>
  <style>
    .glass-border { border:1px solid rgba(0,0,0,.06) }

    /* Tabla estilo inversiones */
    #tblBody tr + tr td { border-top: 1px solid #e8eef5; }
    #tblBody tr:hover { background-color: #fbfdff; }

    /* Pills de estado */
    .pill { display:inline-flex; align-items:center; gap:.375rem; padding:.25rem .6rem; border-radius:999px; font-size:.72rem; font-weight:600; border:1px solid transparent }
    .pill--unread { background:#f3e8ff; color:#6b21a8; border-color:#e9d5ff } /* SIN LEER */
    .pill--read   { background:#e5f4ff; color:#0b5394; border-color:#cfe8ff } /* LEÍDO */

    .plus-cell { color:#2563eb; font-weight:700; cursor:pointer; }

    /* Estilo de filtros (labels arriba e inputs redondeados) */
    .filtro-field { display:flex; flex-direction:column; gap:0.25rem; }
    .filtro-label { font-size:0.875rem; font-weight:600; color:#374151; }
    .filtro-input { width:100%; border-radius:0.75rem; border:1px solid #e5e7eb; padding:0.5rem 0.75rem; background:#f9fafb; outline:none; }
    .filtro-input:focus { border-color:#005C97; box-shadow:0 0 0 2px rgba(0,92,151,.3); }
        .section-header{color:#2c3e50;font-size:1.3em;font-weight:600;margin:20px 0;padding-left:15px;border-left:4px solid #1976d2;border-bottom:2px solid #3498db}

  </style>
</head>
<body class="bg-gray-100 text-ink">

  <!-- TOPBAR -->
  <header class="sticky top-0 z-40 bg-gradient-to-br from-brand1 to-brand2 text-white shadow-md">
    <div class="pl-4 pr-4 lg:pl-72 lg:pr-6 py-3 flex items-center gap-2">
      <button id="btnMenu" class="lg:hidden grid place-items-center size-10 rounded-xl bg-white/10 border border-white/20 hover:bg-white/15 transition">
        <svg viewBox="0 0 24 24" class="w-5 h-5 fill-white"><path d="M3 6h18M3 12h18M3 18h18"/></svg>
      </button>

      <div class="flex items-center gap-3">
        <div class="w-9 h-9 rounded-xl bg-white/15 border border-white/25 grid place-items-center">
          <svg viewBox="0 0 24 24" class="w-5 h-5 fill-white"><path d="M12 2 3 7v10l9 5 9-5V7l-9-5Zm7 6-7 4-7-4m0 0 7-4m7 4v8l-7 4m-7-12v8l7 4"/></svg>
        </div>
        <div class="font-semibold tracking-wide">SGAFCR · Demo</div>
        <div class="mx-2 h-6 w-px bg-white/30 hidden sm:block"></div>
        <div class="opacity-90 hidden sm:block">Notificaciones</div>
      </div>

      <button id="btnBell" class="relative ml-auto grid place-items-center size-10 rounded-xl bg-white/10 border border-white/20 hover:bg-white/15 transition">
        <svg viewBox="0 0 24 24" class="w-5 h-5 fill-white"><path d="M12 22a2.5 2.5 0 0 0 2.5-2.5h-5A2.5 2.5 0 0 0 12 22Zm7-6V11a7 7 0 1 0-14 0v5l-2 2v1h20v-1l-2-2Z"/></svg>
        <span id="badgeCount" class="absolute -top-1 -right-1 min-w-[18px] h-[18px] px-1.5 rounded-full bg-rose-500 text-white text-[11px] grid place-items-center border-2 border-white">0</span>
      </button>

      <!-- Usuario -->
      <div id="btnUser" class="relative ml-2 flex items-center gap-2 bg-white/10 border border-white/20 rounded-full px-2 py-1.5 hover:bg-white/15 cursor-pointer select-none">
        <div class="w-7 h-7 rounded-full bg-white text-brand2 font-extrabold grid place-items-center">E</div>
        <div class="font-semibold hidden sm:block">Evelyn G.</div>
        <svg viewBox="0 0 24 24" class="w-5 h-5 fill-white/80"><path d="m7 10 5 5 5-5z"/></svg>

        <!-- Dropdown usuario -->
        <div id="userDropdown" class="hidden absolute right-0 top-full mt-2 w-56 bg-white text-gray-900 rounded-xl shadow-panel glass-border p-2 z-50">
          <div class="px-2.5 pt-1 pb-2 font-extrabold text-gray-700">Mi Cuenta</div>
          <a href="#perfil" class="flex items-center gap-2 px-2.5 py-2 rounded-lg hover:bg-muted">
            <svg viewBox="0 0 24 24" class="w-5 h-5 fill-gray-700"><path d="M12 12a5 5 0 1 0-5-5 5 5 0 0 0 5 5Zm0 2c-5 0-8 3-8 6v2h16v-2c0-3-3-6-8-6Z"/></svg>
            Perfil
          </a>
          <a href="#preferencias" class="flex items-center gap-2 px-2.5 py-2 rounded-lg hover:bg-muted">
            <svg viewBox="0 0 24 24" class="w-5 h-5 fill-gray-700"><path d="M4 6h16v2H4zm0 5h16v2H4zm0 5h10v2H4z"/></svg>
            Preferencias
          </a>
          <div class="my-1 h-px bg-gray-200"></div>
          <a href="#logout" class="flex items-center gap-2 px-2.5 py-2 rounded-lg hover:bg-muted">
            <svg viewBox="0 0 24 24" class="w-5 h-5 fill-gray-700"><path d="M10 17l5-5-5-5v10zM4 4h4v2H6v12h2v2H4z"/></svg>
            Cerrar sesión
          </a>
        </div>
      </div>

      <!-- Panel de notificaciones (dropdown rápido) -->
      <div id="notiPanel" class="hidden absolute right-4 top-[60px] w-[380px] max-w-[92vw] bg-white text-gray-900 rounded-xl shadow-panel glass-border p-3 z-50">
        <div class="flex items-center justify-between pb-2">
          <div class="font-extrabold">Notificaciones</div>
          <button id="btnMarkAll" class="px-2.5 py-1.5 text-sm rounded-lg border border-gray-200 bg-gray-50 hover:bg-gray-100">Marcar todo leído</button>
        </div>
        <div id="notiList" class="space-y-2 max-h-[50vh] overflow-auto"></div>
        <!-- SIN “ver más” -->
      </div>
    </div>
  </header>

  <!-- SIDENAV FIJO -->
  <aside id="sidenav" class="fixed left-0 top-[4rem] h-screen w-64 bg-white border-r border-line shadow-card p-4 z-30 hidden lg:block">
    <nav class="flex flex-col gap-1"><!-- tu menú --></nav>
  </aside>

  <!-- SIDENAV MOBILE -->
  <aside id="sidenavMobile"
         class="fixed left-4 right-4 top-20 bg-white border border-line shadow-card rounded-2xl p-4 z-40
                opacity-0 -translate-y-3 scale-[.98] pointer-events-none transition lg:hidden">
    <div class="font-extrabold mb-2">Menú principal</div>
    <nav class="flex flex-col gap-1"><!-- tu menú mobile --></nav>
  </aside>

  <!-- CONTENT -->
  <main class="lg:ml-64 px-4 py-5">
    <div class="bg-white rounded-2xl border border-line shadow-card p-5">
      <div class="flex items-end justify-between gap-4 flex-wrap">


        <!-- Filtros SOLO: día + nombre -->
        <div class="grid grid-cols-1 sm:grid-cols-5 gap-4">
            
          <div class="filtro-field sm:col-span-2">
            <label class="filtro-label">Nombre (título/detalle):</label>
            <input id="searchBox" placeholder="Escribe un nombre…" class="filtro-input">
          </div>
          <div class="filtro-field">
            <label class="filtro-label">Fecha (día):</label>
            <input id="dateFilter" type="date" class="filtro-input">
          </div>
          <div class="filtro-field sm:col-span-1">
            <label class="filtro-label"><br></label>
            <button id="btnReset" class="px-3 py-2 rounded-xl border border-line bg-white hover:bg-muted text-sm">Limpiar</button>
          </div>
          <div class="filtro-field sm:col-span-1">
            <label class="filtro-label"><br></label>
             <button id="btnHoy" class="px-3 py-2 rounded-xl border border-line bg-white hover:bg-muted text-sm">Hoy</button>
          </div>
        </div>
      </div>

    <div class="section-header">Listado de Notificaciones</div>

      <!-- Tabla -->
      <div class="mt-4 overflow-x-auto">
        <div class="min-w-[720px] rounded-2xl shadow-card border border-line overflow-hidden">
          <table class="w-full text-sm">
            <thead>
              <tr class="bg-gradient-to-r from-[#0f2740] to-[#1a3a60] text-white">
                <th class="w-10 px-3 py-3 font-medium text-left"></th>
                <th class="px-4 py-3 font-medium text-left">Estado</th>
                <th class="px-4 py-3 font-medium text-left">Título</th>
                <th class="px-4 py-3 font-medium text-left">Detalle</th>
                <th class="px-4 py-3 font-medium text-left">Fecha notificación</th>
                <th class="px-4 py-3 font-medium text-right">Acciones</th>
              </tr>
            </thead>
            <tbody id="tblBody" class="bg-white"></tbody>
          </table>
        </div>
      </div>

      <!-- Footer -->
      <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mt-4">
        <div class="text-sm text-gray-600">
          <span id="countShown">0</span> de <span id="countTotal">0</span> notificaciones mostradas.
        </div>
        <div class="flex gap-2">
          <button id="btnMarkAll2" class="px-3 py-2 rounded-xl border border-line bg-white hover:bg-muted text-sm">Marcar todo leído</button>
        </div>
      </div>
    </div>
  </main>

  <!-- jQuery -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

  <script>
    // ===== Mock =====
    const notifications = [
      {
        id: 1,
        title: "Llamado de capital",
        detail: "Fondo Consolidado de Reservas Previsionales – FCR · S/ 1,250,000.00",
        href: "backoffice-instruccion.html?inv=6122&mov=C-1001&tipo=Llamado&fecha=2024-08-10&monto=1%2C250%2C000.00&doc=call_1001.pdf&bank=BCP",
        unread: true,
        createdAt: new Date() // hoy
      },
      {
        id: 2,
        title: "Registro de Inversión Financiera",
        detail: "Nueva inversión financiera registrada INV #:21742513",
        href: "listado.html",
        unread: true,
        createdAt: new Date() // hoy
      },
      {
        id: 3,
        title: "Nuevo cupón aprobado",
        detail: "Cupón INV #:21742513 aprobado y pendiente de cancelación.",
        href: "listado.html",
        unread: false,
        createdAt: new Date(Date.now() - 24*60*60*1000) // ayer
      }
    ];

    // ===== Utils =====
    const fmtDate = (d) => {
      const dd = String(d.getDate()).padStart(2,'0');
      const mm = String(d.getMonth()+1).padStart(2,'0');
      const yy = d.getFullYear();
      const hh = String(d.getHours()).padStart(2,'0');
      const mi = String(d.getMinutes()).padStart(2,'0');
      return { day:`${yy}-${mm}-${dd}`, human:`${dd}/${mm}/${yy} ${hh}:${mi}` };
    };
    const isSameDay = (a,b) => a.getFullYear()===b.getFullYear() && a.getMonth()===b.getMonth() && a.getDate()===b.getDate();

    function setTodayInDateInput(){
      const { day } = fmtDate(new Date());
      $("#dateFilter").val(day);
    }
    function unreadCount(){ return notifications.filter(n=>n.unread).length; }

    // ===== Campana dropdown =====
    function renderBellDropdown(){
      const $list = $("#notiList").empty();
      notifications
        .slice().sort((a,b)=>b.createdAt - a.createdAt)
        .slice(0,10)
        .forEach(n=>{
          $list.append(`
            <a href="${n.href}" class="block p-3 rounded-xl bg-muted border border-line hover:bg-white transition">
              <div class="flex gap-3">
                <div class="w-2 h-2 mt-2 rounded-full ${n.unread ? 'bg-emerald-500' : 'bg-gray-400'}"></div>
                <div class="flex-1">
                  <div class="font-semibold">${n.title}</div>
                  <div class="text-xs text-gray-500 mt-0.5">${n.detail}</div>
                </div>
              </div>
            </a>
          `);
        });
      $("#badgeCount").text(unreadCount()).toggle(unreadCount()>0);
    }

    // ===== Filtro + render tabla (solo día + nombre) =====
    function applyFiltersAndRender(){
      const selDateStr = $("#dateFilter").val();
      const q = $("#searchBox").val().trim().toLowerCase();
      const selDate = selDateStr ? new Date(selDateStr + "T00:00:00") : null;

      let data = notifications.slice().sort((a,b)=>b.createdAt - a.createdAt);

      data = data.filter(n=>{
        let ok = true;
        if(selDate) ok = ok && isSameDay(n.createdAt, selDate);
        if(q){
          const hay = (n.title + " " + n.detail).toLowerCase();
          ok = ok && hay.includes(q);
        }
        return ok;
      });

      renderTable(data);
      $("#countTotal").text(notifications.length);
      $("#countShown").text(data.length);
      $("#badgeCount").text(unreadCount()).toggle(unreadCount()>0);
    }

    function renderTable(rows){
      const $tb = $("#tblBody").empty();
      if(rows.length===0){
        $tb.append(`<tr><td colspan="6" class="px-4 py-6 text-center text-gray-500">No hay notificaciones para ese día o nombre.</td></tr>`);
        return;
      }
      rows.forEach((n)=>{
        const { human } = fmtDate(n.createdAt);
        const pillHtml = n.unread
          ? `<span class="pill pill--unread"><span class="text-lg leading-none">•</span>SIN LEER</span>`
          : `<span class="pill pill--read"><span class="text-lg leading-none">•</span>LEÍDO</span>`;

        $tb.append(`
          <tr>
            <td class="px-3 py-3 align-top"><span class="plus-cell select-none"></span></td>
            <td class="px-4 py-3 align-top">${pillHtml}</td>
            <td class="px-4 py-3 align-top"><div class="font-medium text-gray-900">${n.title}</div></td>
            <td class="px-4 py-3 align-top text-gray-600">${n.detail}</td>
            <td class="px-4 py-3 align-top whitespace-nowrap">${human}</td>
            <td class="px-4 py-3 align-top text-right">
              <div class="inline-flex gap-2">
                <a href="${n.href}" class="px-2.5 py-1.5 rounded-lg border border-line bg-white hover:bg-muted text-xs">Ver</a>
                ${
                  n.unread
                  ? `<button data-id="${n.id}" class="btn-leer px-2.5 py-1.5 rounded-lg border border-emerald-200 bg-emerald-50 hover:bg-emerald-100 text-emerald-700 text-xs">Marcar leído</button>`
                  : `<button data-id="${n.id}" class="btn-noleer px-2.5 py-1.5 rounded-lg border border-gray-200 bg-gray-50 hover:bg-gray-100 text-gray-700 text-xs">Marcar no leído</button>`
                }
              </div>
            </td>
          </tr>
        `);
      });
    }

    // Expandible “+” (placeholder)
    $(document).on('click', '.plus-cell', function(){
      $(this).toggleClass('text-blue-600').text( $(this).text()==='+' ? '–' : '+' );
    });

    // ===== Eventos =====
    $(function(){
      setTodayInDateInput();
      renderBellDropdown();
      applyFiltersAndRender();

      // Topbar interacciones
      $("#btnBell").on("click", function(e){
        e.stopPropagation();
        $("#notiPanel").toggleClass("hidden");
        $("#userDropdown").addClass("hidden");
      });
      $("#btnMarkAll, #btnMarkAll2").on("click", function(){
        notifications.forEach(n=>n.unread=false);
        renderBellDropdown();
        applyFiltersAndRender();
      });
      $("#btnUser").on("click", function(e){
        e.stopPropagation();
        $("#userDropdown").toggleClass("hidden");
        $("#notiPanel").addClass("hidden");
      });
      $("#btnMenu").on("click", function(e){
        e.stopPropagation();
        const open = $("#sidenavMobile").hasClass("opacity-100");
        $("#sidenavMobile").toggleClass("opacity-100 translate-y-0 scale-100 pointer-events-auto", !open);
      });
      $(document).on("click", function(){
        $("#userDropdown").addClass("hidden");
        $("#notiPanel").addClass("hidden");
        $("#sidenavMobile").removeClass("opacity-100 translate-y-0 scale-100 pointer-events-auto");
      });
      $("#userDropdown, #notiPanel, #sidenavMobile").on("click", e => e.stopPropagation());

      // Filtros (día + nombre)
      $("#dateFilter").on("change", applyFiltersAndRender);
      $("#btnHoy").on("click", function(){ setTodayInDateInput(); applyFiltersAndRender(); });
      $("#searchBox").on("input", applyFiltersAndRender);
      $("#btnReset").on("click", function(){
        $("#searchBox").val('');
        setTodayInDateInput();
        applyFiltersAndRender();
      });

      // Acciones fila
      $(document).on("click", ".btn-leer", function(){
        const id = +$(this).data("id");
        const n = notifications.find(x=>x.id===id);
        if(n){ n.unread = false; }
        renderBellDropdown();
        applyFiltersAndRender();
      });
      $(document).on("click", ".btn-noleer", function(){
        const id = +$(this).data("id");
        const n = notifications.find(x=>x.id===id);
        if(n){ n.unread = true; }
        renderBellDropdown();
        applyFiltersAndRender();
      });
    });
  </script>
</body>
</html>
