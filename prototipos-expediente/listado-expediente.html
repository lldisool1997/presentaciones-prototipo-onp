<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Expediente Digital ¬∑ Documentos</title>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            brand1:'#005C97',
            brand2:'#004a7c',
            ink:'#2c3e50'
          },
          boxShadow: { card:'0 8px 32px rgba(0,0,0,.08)' }
        }
      }
    }
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
</head>
<body class="bg-white text-slate-800">
  <main class="max-w-full mx-auto p-4 md:p-6">
    <!-- Header -->
    <header class="bg-gradient-to-r from-brand1 to-brand2 text-white rounded-2xl rounded-b-none p-6">
      <h1 class="text-2xl md:text-3xl font-semibold">Expediente Digital</h1>
      <p class="opacity-90 text-sm md:text-base">Listado de documentos</p>
    </header>

    <!-- Filtros -->
    <section class="bg-white p-5">
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4">
        <div>
          <label class="block text-sm font-semibold mb-1">Clase Activo</label>
          <select id="fClase" class="w-full rounded-xl border-2 border-gray-200 p-2.5 focus:border-brand1 focus:outline-none">
            <option value="">Todos</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-semibold mb-1">Mercado</label>
          <select id="fMercado" class="w-full rounded-xl border-2 border-gray-200 p-2.5 focus:border-brand1 focus:outline-none" disabled>
            <option value="">Todos</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-semibold mb-1">Subcategor√≠a</label>
          <select id="fSub" class="w-full rounded-xl border-2 border-gray-200 p-2.5 focus:border-brand1 focus:outline-none" disabled>
            <option value="">Todos</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-semibold mb-1">Tipo Instrumento</label>
          <select id="fTipo" class="w-full rounded-xl border-2 border-gray-200 p-2.5 focus:border-brand1 focus:outline-none" disabled>
            <option value="">Todos</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-semibold mb-1">C√≥digo de Inversi√≥n</label>
          <input id="fCodigo" value="INV-6053" type="text" placeholder="Ej: INV-0001"
                 class="w-full rounded-xl border-2 border-gray-200 p-2.5 focus:border-brand1 focus:outline-none"/>
        </div>
      </div>

      <div class="mt-5 flex gap-3">
        <button id="btnBuscar" class="px-5 py-2.5 rounded-xl bg-blue-600 hover:bg-blue-700 text-white font-bold uppercase tracking-wide shadow">
          Buscar
        </button>
        <button id="btnLimpiar" class="px-5 py-2.5 rounded-xl bg-slate-500 hover:bg-slate-600 text-white font-bold uppercase tracking-wide shadow">
          Limpiar
        </button>
      </div>
    </section>
      <section class="bg-white  pb-2 px-5">
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4">
        <div>
          <label class="block font-semibold mb-1 text-[16px]">Expediente: ${EXPEDIENTE}</label>
            <div class="flex flex-row gap-3">
                <div class="font-semibold">Leyenda:</div>
                <div class="flex flex-row gap-2">
                    <img src="svg/close-lock.svg" alt="Ver" class="w-5 h-5 object-contain" loading="lazy" decoding="async">
                    Bloqueado
                </div>
                <div class="flex flex-row gap-2">
                    <img src="svg/open-lock.svg" alt="Ver" class="w-5 h-5 object-contain" loading="lazy" decoding="async">
                    Liberado
                </div>
            </div>
        </div>
      </div>

    </section>
        <!-- Filtros -->
    <section class="bg-white  p-5">
      <div class="grid grid-cols-1 md:grid-cols-1 lg:grid-cols-1 gap-4">
        <div>
               <div class="overflow-x-auto rounded-2xl rounded-t-none text-center justify-center flex">
        <table class="text-sm ">
          <thead class="bg-slate-800 text-white sticky top-0 text-[12px]">
            <tr>
              <th class="px-8 text-center uppercase">N¬∞ Item</th>
              <th class="px-3 text-center uppercase">Clase de Activo</th>
              <th class="px-3 text-center uppercase">Mercado</th>
              <th class="px-3 text-center uppercase">Subcategor√≠a</th>
              <th class="px-3 text-center uppercase">Tipo de Instrumento</th>
              <th class="px-3 text-center uppercase">C√≥digo de Inversi√≥n</th>
              <th class="px-3 text-center uppercase">Asociado al</th>
              <th class="px-3 text-left uppercase">Etiqueta del Documento</th>
              <th class="px-3 text-left uppercase">Nombre del Documento</th>
              <th class="px-3 text-center uppercase">Nro P√°ginas</th>
              <th class="px-3 text-center uppercase">Nro P√°gina Inicial</th>
              <th class="px-3 text-center uppercase">Nro P√°gina Final</th>
              <th class="px-8 text-center uppercase">Ver Detalle</th>
              <th class="px-3 text-center uppercase">grabar</th>
              <th class="px-3 text-center uppercase">editar</th>
              <th class="px-3 text-center uppercase">retirar<br>/eliminar</th>
              <th class="px-3 text-center uppercase">hist√≥rico</th>
              <th class="px-3 text-center uppercase">estado</th>
              <th class="px-3 text-center uppercase">Unidad Org√°nica</th>
            </tr>
          </thead>
          <tbody id="tablaBody" class="[&>tr:nth-child(even)]:bg-slate-50">
            <!-- filas -->
          </tbody>
        </table>
      </div>
        </div>
      </div>

    </section>

    <!-- Tabla -->
    <section class="bg-white rounded-2xl rounded-t-none shadow-[0_12px_24px_-12px_rgba(0,0,0,0.25)]">



      <!-- Empty state -->
      <div id="emptyState" class="hidden p-10 text-center text-slate-500">
        <div class="text-3xl mb-2">üìÑ</div>
        <p>No se encontraron resultados con los filtros actuales.</p>
      </div>

      <!-- Controles de paginaci√≥n -->
<div class="flex flex-col gap-3 px-4 pb-4">
  <div class="flex items-center justify-between flex-wrap gap-3">
    <!-- Items por p√°gina -->
    <div class="flex items-center gap-2">
      <label for="pageSize" class="text-sm text-slate-700">Items por p√°gina</label>
      <select id="pageSize" class="rounded-xl border-2 border-gray-200 py-1.5 px-3 focus:border-brand1 focus:outline-none">
        <option>5</option>
        <option>10</option>
        <option selected>15</option>
        <option>20</option>
        <option>50</option>
      </select>
    </div>

    <!-- Paginaci√≥n -->
    <nav id="pagination" class="inline-flex select-none overflow-hidden rounded-xl border border-slate-200"></nav>
  </div>
</div>
    </section>
    
  </main>

<script>
  /***********************
   *  CONFIG
   ***********************/
  const API_FILTERS_URL = '../recursos/investment-data.json'; // cambia si quieres

  // valores por defecto
const DEFAULTS = {
  clase:  'Inversiones Alternativas',
  mercado:'Local',
  sub:    'Fondos de inversi√≥n',
  tipo:   'Fondo privado'
};


  /***********************
   *  ESTADO
   ***********************/
  let DOCUMENTOS = [];
  let investmentData = {};
  let FILTERED = null;                        // dataset filtrado (o null)
  const STATE = { page: 1, size: 15 };        // paginaci√≥n
  const PAGE_SIZE_OPTIONS = [5, 10, 15, 20, 50];

  /***********************
   *  HELPERS
   ***********************/
  function fillSelect(select, values, includeTodos = true) {
    select.innerHTML = '';
    if (includeTodos) {
      const optAll = document.createElement('option');
      optAll.value = '';
      optAll.textContent = 'Todos';
      select.appendChild(optAll);
    }
    (values || []).forEach(v => {
      const opt = document.createElement('option');
      opt.value = v;
      opt.textContent = v;
      select.appendChild(opt);
    });
    select.disabled = !(values && values.length);
  }

  // valores por defecto

// preseleccionar en cascada
function preselectFilters({clase, mercado, sub, tipo} = {}) {
  const fClase   = document.getElementById('fClase');
  const fMercado = document.getElementById('fMercado');
  const fSub     = document.getElementById('fSub');
  const fTipo    = document.getElementById('fTipo');

  // 1) Clase
  if (clase && investmentData[clase]) {
    fClase.value = clase;
    fClase.dispatchEvent(new Event('change')); // llena mercados
  }

  // 2) Mercado
  if (mercado && fMercado.options.length) {
    fMercado.value = mercado;
    fMercado.dispatchEvent(new Event('change')); // llena subcategor√≠as
  }

  // 3) Subcategor√≠a
  if (sub && fSub.options.length) {
    fSub.value = sub;
    fSub.dispatchEvent(new Event('change')); // llena tipos
  }

  // 4) Tipo
  if (tipo && fTipo.options.length) {
    fTipo.value = tipo;
  }
}

  /***********************
   *  CARGA DE FILTROS (AJAX)
   ***********************/
  async function loadInvestmentData(AJAX_URL) {
    try {
      const data = await $.ajax({
        url: AJAX_URL,
        method: 'GET',
        dataType: 'json',
        cache: false,
        headers: { 'Accept': 'application/json' }
      });
      investmentData = data || {};
    } catch (err) {
      const parsed = err?.responseJSON ? err.responseJSON : (() => { try { return JSON.parse(err?.responseText||''); } catch { return null; } })();
      console.group('AJAX error ¬∑ loadInvestmentData');
      console.error('URL:', AJAX_URL);
      console.error('Status:', err?.status, err?.statusText);
      console.error(parsed ? parsed : (err?.responseText || '').slice(0, 800));
      console.groupEnd();

      // Fallback m√≠nimo para no romper cascada
      investmentData = { "Inversiones Alternativas": { "Local": { "Fondos de inversi√≥n": { "Fondo Privado": {} } } } };
    }
    initCascadingFilters();
  }

  function initCascadingFilters() {
    const fClase   = document.getElementById('fClase');
    const fMercado = document.getElementById('fMercado');
    const fSub     = document.getElementById('fSub');
    const fTipo    = document.getElementById('fTipo');

    fillSelect(fClase, Object.keys(investmentData));

    fClase.onchange = () => {
      const c = fClase.value;
      fillSelect(fMercado, c ? Object.keys(investmentData[c] || {}) : []);
      fillSelect(fSub, []);
      fillSelect(fTipo, []);
    };

    fMercado.onchange = () => {
      const c = fClase.value, m = fMercado.value;
      const subs = (c && m) ? Object.keys((investmentData[c] || {})[m] || {}) : [];
      fillSelect(fSub, subs);
      fillSelect(fTipo, []);
    };

    fSub.onchange = () => {
      const c = fClase.value, m = fMercado.value, s = fSub.value;
      const tipos = (c && m && s) ? Object.keys(((investmentData[c] || {})[m] || {})[s] || {}) : [];
      fillSelect(fTipo, tipos);
    };
  }

  /***********************
   *  DATA DEMO
   ***********************/
  async function fetchDocumentos(){
    return [
      {"bloqueado":true,"orden":1,"clase":"Inversiones Alternativas","mercado":"Local","subcat":"Fondos de inversi√≥n","tipo":"Fondo Privado","codigo":"INV-6053","asociado":"Instrumento","etiqueta":"Informe de Riesgos","nombre":"informe-riesgos.pdf","paginas":8,"pinicial":1,"pfinal":8,"uo":"DIN.IF","msj":"√âXITO", "estado": "√âXITO"},
      {"bloqueado":false,"orden":2,"clase":"Inversiones Alternativas","mercado":"Local","subcat":"Fondos de inversi√≥n","tipo":"Fondo Privado","codigo":"INV-6053","asociado":"Instrumento","etiqueta":"Informe Legal","nombre":"informe-legal.pdf","paginas":1,"pinicial":9,"pfinal":9,"uo":"DIN.IF","msj":"√âXITO", "estado": "√âXITO"},
      {"bloqueado":false,"orden":3,"clase":"Inversiones Alternativas","mercado":"Local","subcat":"Fondos de inversi√≥n","tipo":"Fondo Privado","codigo":"INV-6053","asociado":"Instrumento","etiqueta":"Acta de Comit√© de Inversiones","nombre":"acta-de-comite-de-inversiones.pdf","paginas":2,"pinicial":10,"pfinal":11,"uo":"DIN.IF","msj":"√âXITO", "estado": "√âXITO"},
      {"bloqueado":true,"orden":4,"clase":"Inversiones Alternativas","mercado":"Local","subcat":"Fondos de inversi√≥n","tipo":"Fondo Privado","codigo":"INV-6053","asociado":"Instrumento","etiqueta":"Acta de Suscripci√≥n","nombre":"acta-de-suscripcion.pdf","paginas":5,"pinicial":12,"pfinal":16,"uo":"DIN.IF","msj":"√âXITO", "estado": "√âXITO"},
      {"bloqueado":false,"orden":5,"clase":"Inversiones Alternativas","mercado":"Local","subcat":"Fondos de inversi√≥n","tipo":"Fondo Privado","codigo":"INV-6053","asociado":"Llamado de Capital","etiqueta":"Documento de notificaci√≥n del llamado","nombre":"documento-notificacion.pdf","paginas":3,"pinicial":17,"pfinal":19,"uo":"DIN.IF","msj":"√âXITO", "estado": "√âXITO"},
      {"bloqueado":true,"orden":6,"clase":"Inversiones Alternativas","mercado":"Local","subcat":"Fondos de inversi√≥n","tipo":"Fondo Privado","codigo":"INV-6053","asociado":"Desagregado de Llamado de Capital","etiqueta":"Constancia de operaci√≥n","nombre":"constancia-operacion.pdf","paginas":7,"pinicial":20,"pfinal":26,"uo":"OAD.TE","msj":"√âXITO", "estado": "√âXITO"},
      {"bloqueado":true,"orden":6,"clase":"Inversiones Alternativas","mercado":"Local","subcat":"Fondos de inversi√≥n","tipo":"Fondo Privado","codigo":"INV-6053","asociado":"Distribuci√≥n de Capital","etiqueta":"Documento de notificaci√≥n de la distribuci√≥n","nombre":"constancia-operacion.pdf","paginas":7,"pinicial":20,"pfinal":26,"uo":"DIN.IF","msj":"√âXITO", "estado": "√âXITO"},
      {"bloqueado":true,"orden":6,"clase":"Inversiones Alternativas","mercado":"Local","subcat":"Fondos de inversi√≥n","tipo":"Fondo Privado","codigo":"INV-6053","asociado":"Desagregado Distribuci√≥n de Capital","etiqueta":"Constancia de operaci√≥n","nombre":"documento-notificacion.pdf","paginas":7,"pinicial":20,"pfinal":26,"uo":"OAD.TE","msj":"√âXITO", "estado": "√âXITO"},
    ];
  }

  /***********************
   *  RENDER TABLA
   ***********************/
  function renderTabla(list){
    const tbody = document.getElementById('tablaBody');
    const empty = document.getElementById('emptyState');
    tbody.innerHTML = '';

    if(!list.length){
      empty.classList.remove('hidden');
      return;
    }
    empty.classList.add('hidden');

    const rows = list.map(d => `
      <tr class="hover:bg-blue-50 transition">
        <td class="px-3 py-2 text-[12px]">
  <div class="flex items-center justify-center">
    <!-- √≠cono -->
    <a href="#ver-doc"
       class="inline-flex h-8 w-8 items-center justify-center rounded-lg
              text-slate-600 hover:text-blue-700
              focus:outline-none focus:ring-2 focus:ring-blue-500/60"
       title="Ver documento" aria-label="Ver documento">
      <img src="svg/lock.svg" alt="Ver" class="w-5 h-5 object-contain" loading="lazy" decoding="async">
    </a>

    <!-- n√∫mero (misma altura que el √≠cono) -->
    <a href="#ver-doc"
       class="inline-flex h-8 min-w-[2rem] items-center justify-center rounded-lg
              text-slate-600 hover:text-blue-700 leading-none
              focus:outline-none focus:ring-2 focus:ring-blue-500/60"
       title="Ver documento" aria-label="Ver documento">
      <span class="tabular-nums">${d.orden ?? ''}</span>
    </a>
  </div>
</td>

        <td class="px-3 py-2 text-[12px] text-center">${d.clase ?? ''}</td>
        <td class="px-3 py-2 text-[12px] text-center">${d.mercado ?? ''}</td>
        <td class="px-3 py-2 text-[12px] text-center">${d.subcat ?? ''}</td>
        <td class="px-3 py-2 text-[12px] text-center">${d.tipo ?? ''}</td>
        <td class="px-3 py-2 text-[12px] text-center font-semibold text-slate-700">${d.codigo ?? ''}</td>
        <td class="px-3 py-2 text-[12px] text-center">${d.asociado ?? ''}</td>
        <td class="px-3 py-2 text-[12px] text-left">${d.etiqueta ?? ''}</td>
        <td class="px-3 py-2 text-[12px] text-left">${d.nombre ?? ''}</td>
        <td class="px-3 py-2 text-[12px] text-center">${d.paginas ?? ''}</td>
        <td class="px-3 py-2 text-[12px] text-center">${d.pinicial ?? ''}</td>
        <td class="px-3 py-2 text-[12px] text-center">${d.pfinal ?? ''}</td>
 <td class="px-3 py-2 text-[12px] text-center">
  <a href="#ver-doc" class="inline-flex bg-blue-700 items-center justify-center p-1.5 rounded-lg
                          text-slate-600 hover:text-blue-700 hover:bg-blue-800
                          focus:outline-none focus:ring-2 focus:ring-blue-500/60"
     title="Ver documento" aria-label="Ver documento">
    <img src="svg/visor.svg" alt="Ver" class="w-5 h-5 object-contain" loading="lazy" decoding="async">
  </a>
  <a href="#descargar-doc" class="inline-flex bg-blue-700 items-center justify-center p-1.5 rounded-lg
                                text-slate-600 hover:text-blue-700 hover:bg-blue-800
                                focus:outline-none focus:ring-2 focus:ring-blue-500/60"
     title="Descargar documento" aria-label="Descargar documento">
    <img src="svg/descargar.svg" alt="Descargar" class="w-5 h-5 object-contain" loading="lazy" decoding="async">
  </a>
</td>

<td class="px-3 py-2 text-[12px] text-center">
  <a href="#grabar-doc" class="inline-flex bg-blue-700 items-center justify-center p-1.5 rounded-lg
                            text-slate-600 hover:text-blue-700 hover:bg-blue-800
                            focus:outline-none focus:ring-2 focus:ring-blue-500/60"
     title="Grabar" aria-label="Grabar">
    <img src="svg/grabar.svg" alt="Grabar" class="w-5 h-5 object-contain" loading="lazy" decoding="async">
  </a>
</td>

<td class="px-3 py-2 text-[12px] text-center">
  <a href="#editar-doc" class="inline-flex bg-blue-700 items-center justify-center p-1.5 rounded-lg
                            text-slate-600 hover:text-blue-700 hover:bg-blue-800
                            focus:outline-none focus:ring-2 focus:ring-blue-500/60"
     title="Editar" aria-label="Editar">
    <img src="svg/editar.svg" alt="Editar" class="w-5 h-5 object-contain" loading="lazy" decoding="async">
  </a>
</td>

<td class="px-3 py-2 text-[12px] text-center">
  <a href="#eliminar-doc" class="inline-flex bg-blue-700 items-center justify-center p-1.5 rounded-lg
                              text-slate-600 hover:text-blue-700 hover:bg-blue-800
                              focus:outline-none focus:ring-2 focus:ring-blue-500/60"
     title="Retirar/Eliminar" aria-label="Retirar o eliminar">
    <img src="svg/trash.svg" alt="Eliminar" class="w-5 h-5 object-contain" loading="lazy" decoding="async">
  </a>
</td>

<td class="px-3 py-2 text-[12px] text-center">
  <a href="#vista-previa" class="inline-flex bg-blue-700 items-center justify-center p-1.5 rounded-lg
                                text-slate-600 hover:text-blue-700 hover:bg-blue-800
                                focus:outline-none focus:ring-2 focus:ring-blue-500/60"
     title="Vista previa" aria-label="Vista previa">
    <img src="svg/visor.svg" alt="Vista previa" class="w-5 h-5 object-contain" loading="lazy" decoding="async">
  </a>
</td>

   <td class="px-3 py-2 text-[12px] text-center">${d.estado ?? ''}</td>


        <td class="px-3 py-2 text-[12px] text-center">
            <div class="p-1 border border-blue-400 bg-blue-200 rounded-lg">
                <b class="text-blue-900">${d.uo ?? ''}</b>
            </div>
            </td>
      </tr>
    `).join('');
    tbody.insertAdjacentHTML('beforeend', rows);
  }

  /***********************
   *  PAGINACI√ìN
   ***********************/
  function datasetActual(){ return FILTERED ?? DOCUMENTOS; }

  function clampPage(totalPages){
    if (STATE.page < 1) STATE.page = 1;
    if (STATE.page > totalPages) STATE.page = totalPages || 1;
  }

  function pageSlice(ds){
    const start = (STATE.page - 1) * STATE.size;
    return ds.slice(start, start + STATE.size);
  }

  function renderPagination(totalItems){
    const nav = document.getElementById('pagination');
    nav.innerHTML = '';

    const totalPages = Math.max(1, Math.ceil(totalItems / STATE.size));
    clampPage(totalPages);

    const btn = (label, page, {active=false, disabled=false}={}) => `
      <button type="button" data-page="${page}"
        class="px-3 py-1.5 ${active ? 'bg-slate-800 text-white' : 'bg-white text-slate-700'} ${disabled ? 'opacity-40 cursor-not-allowed' : 'hover:bg-slate-100'}">
        ${label}
      </button>`;

    // ¬´
    nav.insertAdjacentHTML('beforeend', btn('¬´', STATE.page - 1, {disabled: STATE.page === 1}));

    // n√∫meros con ventana [curr-1, curr, curr+1] + extremos
    const pages = [];
    const push = p => { if (!pages.includes(p) && p>=1 && p<=totalPages) pages.push(p); };
    push(1); push(STATE.page-1); push(STATE.page); push(STATE.page+1); push(totalPages);
    pages.sort((a,b)=>a-b);

    let last = 0;
    for (const p of pages) {
      if (p - last > 1) nav.insertAdjacentHTML('beforeend', `<span class="px-2 py-1.5 bg-white text-slate-400">‚Ä¶</span>`);
      nav.insertAdjacentHTML('beforeend', btn(String(p), p, {active: p===STATE.page}));
      last = p;
    }

    // ¬ª
    nav.insertAdjacentHTML('beforeend', btn('¬ª', STATE.page + 1, {disabled: STATE.page === totalPages}));

    // Delegaci√≥n de eventos
    nav.onclick = (e) => {
      const b = e.target.closest('button[data-page]');
      if (!b) return;
      const next = Number(b.dataset.page);
      if (Number.isNaN(next)) return;
      if (next < 1 || next > totalPages) return;
      STATE.page = next;
      refreshView();
    };
  }

  function refreshView(){
    const ds = datasetActual();
    const total = ds.length;
    const totalPages = Math.max(1, Math.ceil(total / STATE.size));
    clampPage(totalPages);

    // si est√° fuera de rango despu√©s de un filtro, ajusta y corta
    renderPagination(total);
    renderTabla(pageSlice(ds));

    // empty state si no hay nada
    document.getElementById('emptyState').classList.toggle('hidden', total > 0);
  }

  // Cambio de page size
  document.getElementById('pageSize').addEventListener('change', (e) => {
    const val = Number(e.target.value);
    STATE.size = PAGE_SIZE_OPTIONS.includes(val) ? val : 15;
    STATE.page = 1;
    refreshView();
  });

  /***********************
   *  FILTROS
   ***********************/
  function aplicarFiltros(){
    const fClase  = document.getElementById('fClase').value;
    const fMerc   = document.getElementById('fMercado').value;
    const fSub    = document.getElementById('fSub').value;
    const fTipo   = document.getElementById('fTipo').value;
    const fCodigo = document.getElementById('fCodigo').value.trim().toLowerCase();

    const out = DOCUMENTOS.filter(d => {
      if (fClase && d.clase !== fClase) return false;
      if (fMerc && d.mercado !== fMerc) return false;
      if (fSub && d.subcat !== fSub) return false;
      if (fTipo && d.tipo !== fTipo) return false;
      if (fCodigo && !(d.codigo||'').toLowerCase().includes(fCodigo)) return false;
      return true;
    });

    FILTERED = out.length ? out : [];
    STATE.page = 1;
    refreshView();
  }

  document.getElementById('btnBuscar').addEventListener('click', aplicarFiltros);
  document.getElementById('btnLimpiar').addEventListener('click', () => {
    document.getElementById('fClase').value = '';
    fillSelect(document.getElementById('fMercado'), []);
    fillSelect(document.getElementById('fSub'), []);
    fillSelect(document.getElementById('fTipo'), []);
    document.getElementById('fCodigo').value = '';
    FILTERED = null;
    STATE.page = 1;
    refreshView();
  });

  // Buscar con Enter
  document.getElementById('fCodigo').addEventListener('keydown', (e) => {
    if (e.key === 'Enter') aplicarFiltros();
  });

  /***********************
   *  INIT
   ***********************/
  (async function init(){
    await loadInvestmentData("../recursos/investment.json"); // filtros
     preselectFilters(DEFAULTS);                               // ‚Üê preselecciona
    DOCUMENTOS = await fetchDocumentos();                    // data demo
    refreshView();                                           // primera carga con paginaci√≥n
  })();
</script>

</body>
</html>
