<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SGAFCR · Layout (Sidenav fijo + Notificaciones con href)</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            brand1: '#005C97',
            brand2: '#004a7c',
            line: '#e8eef5',
            muted: '#f9fafb',
            ink: '#2c3e50'
          },
          boxShadow: {
            card: '0 8px 32px rgba(0,0,0,.08)',
            panel: '0 10px 30px rgba(0,0,0,.15)'
          }
        }
      }
    }
  </script>
  <style>
    .glass-border { border:1px solid rgba(0,0,0,.06) }
  </style>
</head>
<body class="bg-gray-100 text-ink">

  <!-- TOPBAR -->
  <header class="sticky top-0 z-40 bg-gradient-to-br from-brand1 to-brand2 text-white shadow-md">
    <div class="pl-4 pr-4 lg:pl-72 lg:pr-6 py-3 flex items-center gap-2">
      <!-- Mobile: botón abre/cierra sidenav -->
      <button id="btnMenu" class="lg:hidden grid place-items-center size-10 rounded-xl bg-white/10 border border-white/20 hover:bg-white/15 transition">
        <svg viewBox="0 0 24 24" class="w-5 h-5 fill-white"><path d="M3 6h18M3 12h18M3 18h18"/></svg>
      </button>

      <!-- Marca -->
      <div class="flex items-center gap-3">
        <div class="w-9 h-9 rounded-xl bg-white/15 border border-white/25 grid place-items-center">
          <svg viewBox="0 0 24 24" class="w-5 h-5 fill-white"><path d="M12 2 3 7v10l9 5 9-5V7l-9-5Zm7 6-7 4-7-4m0 0 7-4m7 4v8l-7 4m-7-12v8l7 4"/></svg>
        </div>
        <div class="font-semibold tracking-wide">SGAFCR · Demo</div>
        <div class="mx-2 h-6 w-px bg-white/30 hidden sm:block"></div>
        <div class="opacity-90 hidden sm:block">Flujo de navegación</div>
      </div>

      <!-- Buscador -->
      <!--<div class="ml-auto flex-1 max-w-md hidden md:flex items-center gap-2 bg-white/10 border border-white/20 rounded-xl px-3 py-2">
        <svg viewBox="0 0 24 24" class="w-4 h-4 fill-white/90"><path d="M10 18a8 8 0 1 1 5.3-14l4.7 4.7-1.4 1.4-4.7-4.7A6 6 0 1 0 10 16a6 6 0 0 0 4.6-2.2l1.5 1.3A8 8 0 0 1 10 18Z"/></svg>
        <input placeholder="Buscar… (mock)" class="w-full bg-transparent outline-none placeholder-white/70 text-white"/>
      </div>-->

      <!-- Campana -->
      <button id="btnBell" class="relative ml-auto grid place-items-center size-10 rounded-xl bg-white/10 border border-white/20 hover:bg-white/15 transition">
        <svg viewBox="0 0 24 24" class="w-5 h-5 fill-white"><path d="M12 22a2.5 2.5 0 0 0 2.5-2.5h-5A2.5 2.5 0 0 0 12 22Zm7-6V11a7 7 0 1 0-14 0v5l-2 2v1h20v-1l-2-2Z"/></svg>
        <span id="badgeCount" class="absolute -top-1 -right-1 min-w-[18px] h-[18px] px-1.5 rounded-full bg-rose-500 text-white text-[11px] grid place-items-center border-2 border-white">3</span>
      </button>

      <!-- Usuario -->
      <div id="btnUser" class="relative ml-2 flex items-center gap-2 bg-white/10 border border-white/20 rounded-full px-2 py-1.5 hover:bg-white/15 cursor-pointer select-none">
        <div class="w-7 h-7 rounded-full bg-white text-brand2 font-extrabold grid place-items-center" id="userChar">E</div>
        <div class="font-semibold hidden sm:block" id="user">Evelyn G.</div>
        <svg viewBox="0 0 24 24" class="w-5 h-5 fill-white/80"><path d="m7 10 5 5 5-5z"/></svg>

        <!-- Dropdown usuario (posicionado bajo el botón) -->
        <div id="userDropdown" class="hidden absolute right-0 top-full mt-2 w-56 bg-white text-gray-900 rounded-xl shadow-panel glass-border p-2 z-50">
          <div class="px-2.5 pt-1 pb-2 font-extrabold text-gray-700">Mi Cuenta</div>
          <a href="#perfil" class="flex items-center gap-2 px-2.5 py-2 rounded-lg hover:bg-muted">
            <svg viewBox="0 0 24 24" class="w-5 h-5 fill-gray-700"><path d="M12 12a5 5 0 1 0-5-5 5 5 0 0 0 5 5Zm0 2c-5 0-8 3-8 6v2h16v-2c0-3-3-6-8-6Z"/></svg>
            Perfil
          </a>
          <a href="#preferencias" class="flex items-center gap-2 px-2.5 py-2 rounded-lg hover:bg-muted">
            <svg viewBox="0 0 24 24" class="w-5 h-5 fill-gray-700"><path d="M4 6h16v2H4zm0 5h16v2H4zm0 5h10v2H4z"/></svg>
            Preferencias
          </a>
          <div class="my-1 h-px bg-gray-200"></div>
          <a href="#logout" class="flex items-center gap-2 px-2.5 py-2 rounded-lg hover:bg-muted">
            <svg viewBox="0 0 24 24" class="w-5 h-5 fill-gray-700"><path d="M10 17l5-5-5-5v10zM4 4h4v2H6v12h2v2H4z"/></svg>
            Cerrar sesión
          </a>
        </div>
      </div>

      <!-- Panel de notificaciones (con enlaces href) -->
      <div id="notiPanel" class="hidden absolute right-4 top-[60px] w-[380px] max-w-[92vw] bg-white text-gray-900 rounded-xl shadow-panel glass-border p-3 z-50">
        <div class="flex items-center justify-between pb-2">
          <div class="font-extrabold">Notificaciones</div>
          <button id="btnMarkAll" class="px-2.5 py-1.5 text-sm rounded-lg border border-gray-200 bg-gray-50 hover:bg-gray-100">Marcar todo leído</button>
        </div>
        <div id="notiList" class="space-y-2 max-h-[50vh] overflow-auto"></div>
        <a href="lista-notificaciones.html"
   class="mt-3 mx-auto block px-4 py-2 rounded-xl border border-line bg-white hover:bg-muted text-sm text-gray-700 text-center">
  Ver más…
</a>

      </div>
    </div>
  </header>

  <!-- SIDENAV FIJO A LA IZQUIERDA -->
  <aside id="sidenav"
         class="fixed left-0 top-[4rem] h-screen w-64 bg-white border-r border-line shadow-card p-4 z-30
                hidden lg:block">
   <!--<nav class="flex flex-col gap-1">
      <a href="#inicio" class="flex items-center gap-3 px-3 py-2 rounded-xl hover:bg-blue-50 border border-transparent text-sm font-medium bg-blue-50 border-blue-100 text-blue-700">
        <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor"><path d="M12 3l9 8-1.4 1.4L18 10.3V20h-5v-6H11v6H6v-9.7L4.4 12.4 3 11z"/></svg>
        Inicio
      </a>
      <a href="#inversiones" class="flex items-center gap-3 px-3 py-2 rounded-xl hover:bg-blue-50 border border-transparent text-sm">
        <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor"><path d="M4 4h7v7H4zm9 0h7v7h-7zM4 13h7v7H4zm9 7v-7h7v7z"/></svg>
        Inversiones
      </a>
      <a href="homologacion.html" target="_blank" class="flex items-center gap-3 px-3 py-2 rounded-xl hover:bg-blue-50 border border-transparent text-sm">
        <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor"><path d="M3 5h18v2H3zm0 6h18v2H3zm0 6h12v2H3z"/></svg>
        Homologación
      </a>
      <a href="#reportes" class="flex items-center gap-3 px-3 py-2 rounded-xl hover:bg-blue-50 border border-transparent text-sm">
        <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2a10 10 0 1 0 10 10A10 10 0 0 0 12 2ZM7 11h10v2H7z"/></svg>
        Reportes
      </a>

      <div class="text-xs uppercase tracking-wider text-gray-500 font-extrabold mt-3 mb-1 px-1">Administración</div>
      <a href="#usuarios" class="flex items-center gap-3 px-3 py-2 rounded-xl hover:bg-blue-50 border border-transparent text-sm">
        <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor"><path d="M12 8a4 4 0 1 0 4 4 4 4 0 0 0-4-4Zm8-1-1-3-3-1-2 2a7.9 7.9 0 0 0-2 0L8 3 5 4 4 7l2 2a7.9 7.9 0 0 0 0 2L4 13l1 3 3 1 2-2a7.9 7.9 0 0 0 2 0l2 2 3-1 1-3-2-2a7.9 7.9 0 0 0 0-2Z"/></svg>
        Usuarios y permisos
      </a>
      <a href="#parametros" class="flex items-center gap-3 px-3 py-2 rounded-xl hover:bg-blue-50 border border-transparent text-sm">
        <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor"><path d="M4 6h16v12H4zm2 2v8h12V8z"/></svg>
        Parámetros del sistema
      </a>
    </nav>-->
  </aside>

  <!-- SIDENAV MOBILE (overlay) -->
  <aside id="sidenavMobile"
         class="fixed left-4 right-4 top-20 bg-white border border-line shadow-card rounded-2xl p-4 z-40
                opacity-0 -translate-y-3 scale-[.98] pointer-events-none transition lg:hidden">
    <div class="font-extrabold mb-2">Menú principal</div>
    <nav class="flex flex-col gap-1">
      <a href="#inicio" class="px-3 py-2 rounded-xl hover:bg-blue-50 text-sm">Inicio</a>
      <a href="#inversiones" class="px-3 py-2 rounded-xl hover:bg-blue-50 text-sm">Inversiones</a>
      <a href="homologacion.html" target="_blank" class="px-3 py-2 rounded-xl hover:bg-blue-50 text-sm">Homologación</a>
      <a href="#reportes" class="px-3 py-2 rounded-xl hover:bg-blue-50 text-sm">Reportes</a>
      <div class="text-xs uppercase tracking-wider text-gray-500 font-extrabold mt-3 mb-1 px-1">Administración</div>
      <a href="#usuarios" class="px-3 py-2 rounded-xl hover:bg-blue-50 text-sm">Usuarios y permisos</a>
      <a href="#parametros" class="px-3 py-2 rounded-xl hover:bg-blue-50 text-sm">Parámetros del sistema</a>
    </nav>
  </aside>

  <!-- CONTENT (margen a la izquierda para el sidenav fijo) -->
  <!--<main class="lg:ml-64 px-4 py-5">
    <div class="bg-white rounded-2xl border border-line shadow-card p-5 min-h-[60vh]">
      <h2 class="text-xl font-semibold mb-2">Vista de ejemplo</h2>
      <p class="text-gray-600">Layout con <b>sidenav fijo</b>, <b>dropdown de usuario</b> bien posicionado y <b>notificaciones con href</b>.</p>

      <div class="mt-4 border border-line rounded-2xl p-5 bg-muted">
        <p class="mb-1"><b>Tips:</b></p>
        <ul class="list-disc pl-5 space-y-1 text-gray-700">
          <li>Clic en la <b>campana</b> para abrir/cerrar notificaciones. Cada notificación es un enlace.</li>
          <li>Clic en el <b>usuario</b> para abrir/cerrar el menú de cuenta (dropdown correcto).</li>
          <li>En <b>mobile</b>, el botón hamburguesa abre el <b>sidenav overlay</b>.</li>
        </ul>
      </div>
    </div>
  </main>-->

  <!-- jQuery -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <script>
   "use strict";

// Mock de notificaciones con HREF real
const notifications = [
  {
    id: 1,
    title: "Llamado de capital",
    detail: "Se ha registrando un llamado de capital con el código de instrumento INV-6053 · S/ 1,000,000.00",
    href: "backoffice-confirmar-operacion-llamado.html?inv=6122&mov=C-1001&tipo=Llamado&fecha=2024-19-09&monto=1%2C000%2C000.00&doc=call_1001.pdf&ctas=1&area=Tesoreria&bank=Banco+de+Crédito+del+Perú+%28BCP%29",
    unread: true
  },
  {
    id: 2,
    title: "Registro de Inversión Financiera",
    detail: "Nueva inversión financiera registrada INV #:6053",
    href: "listado-llamado-capital-dist.html",
    unread: true
  },
  {
    id: 3,
    title: "Nuevo cupón aprobado",
    detail: "El cupón con INV #:21742513 ha sido aprobado y está pendiente de cancelación.",
    href: "listado.html",
    unread: true
  },
  {
    id: 4,
    title: "Se ha registrado una distribución de capital",
    detail: "Se ha registrado una distribución de capital con INV-6053",
    href: "listado-llamado-capital-dist.html",
    unread: true
  },
    {
    id: 5,
    title: "Desagregado Registrado",
    detail: "OGR ha registrado el desagregado de un llamado a capital",
    href: "listado-llamado-capital-dist.html",
    unread: true
  },
   {
    id: 6,
    title: "Operación Realizada",
    detail: "Tesorería ha realizado la operación bancaria solicitada para el llamado de capital",
    href: "listado-llamado-capital-dist.html",
    unread: true
  },
     {
    id: 7,
    title: "Desagregado Registrado",
    detail: "OGR ha registrado el desagregado de una distribución de capital",
    href: "listado-llamado-capital-dist.html",
    unread: true
  },
     {
    id: 8,
    title: "Operación Realizada",
    detail: "Tesorería ha verificado la operación bancaria relacionada con la distribución de capital",
    href: "listado-llamado-capital-dist.html",
    unread: true
  },
    {
    id: 9,
    title: "Distribución de capital",
    detail: "Se ha realizado una distribución de capital por S/ 1,000,000.00",
    href: "backoffice-confirmar-operacion-dist.html?inv=6122&mov=C-1004&tipo=Distribucion&fecha=2024-19-09&monto=1%2C000%2C000.00&doc=dist_1004.pdf&ctas=1&area=Tesoreria&bank=Banco+de+Crédito+del+Perú+%28BCP%29",
    unread: true
  },
    {
    id: 10,
    title: "Se ha registrado un llamado de capital",
    detail: "Se ha registrado un llamado de capital con INV-6053",
    href: "listado-llamado-capital-dist.html",
    unread: true
  },
   {
    id: 11,
    title: "Se ha notificado el vencimiento de una inversión",
    detail: "Se ha registrado la instrucción para la recepción de monto + intereses del instrumento INV-7000",
    href: "lista-subasta.html",
    unread: true
  },
     {
    id: 12,
    title: "Se ha realizado una instrucción para transferencia de fondos",
    detail: "Se ha realizado una instrucción de transferencia de fondos con un monto de 150,000,000.00 para INV-7000",
    href: "lista-subasta.html",
    unread: true
  },
  {
    id: 13,
    title: "Se ha realizado la transferencia de fondos",
    detail: "Se ha realizado la transferencia de fondos con un monto de 150,000,000.00 para INV-7000",
    href: "lista-subasta.html",
    unread: true
  },
    {
    id: 14,
    title: "Se ha realizado la aprobación de la inversión",
    detail: "Se ha realizado la aprobación de la inversión con un monto de 150,000,000.00 para INV-7000",
    href: "lista-subasta.html",
    unread: true
  }
  // Ejemplos adicionales que dejaste comentados:
  /*
  {
    id: 4,
    title: "Retorno de capital",
    detail: "Monroe Capital Fund III · USD 2,661,020",
    href: "backoffice-instruccion.html?inv=6122&mov=C-1001&tipo=Llamado&fecha=2024-08-10&monto=1%2C250%2C000.00&doc=call_1001.pdf&bank=Banco+de+Crédito+del+Perú+%28BCP%29",
    unread: true
  },
  {
    id: 5,
    title: "Capital Call & Distribución",
    detail: "Credicorp Inmobiliario Perú · S/ 3,611,528.93",
    href: "#credicorp",
    unread: false
  }
  */
];

// ===== Helpers =====
function getQueryParam(name){
  try {
    return new URLSearchParams(window.location.search).get(name);
  } catch(_) {
    return null;
  }
}

// Estado: id seleccionado por query (?id_notificacion=)
let selectedNotiId = null;

// Render con filtro opcional por ID
function renderNotifications(idSelected){
  const $list = $("#notiList").empty();

  // Lista a pintar
  const list = idSelected
    ? notifications.filter(n => String(n.id) === String(idSelected))
    : notifications;

  // === Badge: ahora cuenta según el alcance ===
  // - si hay idSelected: cuenta no leídos SOLO de la lista filtrada
  // - si no hay idSelected: cuenta no leídos de todo el arreglo
  const sourceForBadge = idSelected ? list : notifications;
  const unreadTotal = sourceForBadge.reduce((acc, n) => acc + (n.unread ? 1 : 0), 0);
  $("#badgeCount").text(unreadTotal).toggle(unreadTotal > 0);

  if (!list.length){
    $list.append(`
      <div class="p-3 text-sm text-gray-500">
        No se encontró la notificación solicitada.
      </div>
    `);
    return;
  }

  list.forEach(n=>{
    $list.append(`
      <a href="${n.href}" class="block p-3 rounded-xl bg-muted border border-line hover:bg-white transition">
        <div class="flex gap-3">
          <div class="w-2 h-2 mt-2 rounded-full ${n.unread ? 'bg-emerald-500' : 'bg-gray-400'}"></div>
          <div class="flex-1">
            <div class="font-semibold">${n.title}</div>
            <div class="text-xs text-gray-500 mt-0.5">${n.detail}</div>
          </div>
        </div>
      </a>
    `);
  });
}

// Mobile sidenav helpers
function openMobileNav(){
  $("#sidenavMobile").addClass("opacity-100 translate-y-0 scale-100 pointer-events-auto");
}
function closeMobileNav(){
  $("#sidenavMobile").removeClass("opacity-100 translate-y-0 scale-100 pointer-events-auto");
}
function toggleMobileNav(){
  const open = $("#sidenavMobile").hasClass("opacity-100");
  open ? closeMobileNav() : openMobileNav();
}
function setUserName(user){
  $("#user").text(user);
  $("#userChar").text(user ? user.charAt(0).toUpperCase() : 'U');
}
// ===== Init =====
$(function(){
  // Leer param y renderizar
  selectedNotiId = getQueryParam("id_notificacion");
  const user = getQueryParam("user");
  renderNotifications(selectedNotiId);
  setUserName(user || "Tesorería");

  // Abrir/cerrar notificaciones (campana)
  $("#btnBell").on("click", function(e){
    e.stopPropagation();
    $("#notiPanel").toggleClass("hidden");
    $("#userDropdown").addClass("hidden");
  });

  // Marcar todo como leído (mantiene el filtro vigente)
  $("#btnMarkAll").on("click", function(){
    notifications.forEach(n => n.unread = false);
    renderNotifications(selectedNotiId);
  });

  // Usuario (dropdown)
  $("#btnUser").on("click", function(e){
    e.stopPropagation();
    $("#userDropdown").toggleClass("hidden");
    $("#notiPanel").addClass("hidden");
  });

  // Mobile sidenav
  $("#btnMenu").on("click", function(e){
    e.stopPropagation();
    toggleMobileNav();
  });

  // Cerrar paneles si clic fuera
  $(document).on("click", function(){
    $("#userDropdown").addClass("hidden");
    $("#notiPanel").addClass("hidden");
    closeMobileNav();
  });

  // Evitar cierre al click dentro
  $("#userDropdown, #notiPanel, #sidenavMobile").on("click", function(e){
    e.stopPropagation();
  });
});
  </script>
</body>
</html>
