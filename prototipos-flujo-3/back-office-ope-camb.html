<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Operación Cambiaria</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Toastr -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" rel="stylesheet"/>

  <!-- Select2 -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" rel="stylesheet"/>

  <!-- libs -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/cleave.js/1.6.0/cleave.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <!-- jsPDF CDN -->
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
<script>
  window.jsPDF = window.jspdf.jsPDF; // habilita jsPDF globalmente
</script>

  <!-- Estilos opcionales -->
  <style>
    .header{background:#0f5a86;color:#fff;padding:24px 20px}
    .header h1{font-weight:700;font-size:20px}
    .oc-tablist{display:flex;gap:.5rem;flex-wrap:wrap}
    .oc-tab{padding:.5rem .75rem;border:1px solid #e5e7eb;border-bottom:none;border-radius:.5rem .5rem 0 0;background:#f8fafc}
    .oc-tab.is-active{background:#fff;font-weight:600;border-bottom:1px solid #fff}
    .oc-panels .oc-panel{display:none}
    .oc-panels .oc-panel.is-active{display:block}
    .section-header{font-weight:600;margin:10px 0 8px}
    .lbl{display:block;font-size:.85rem;color:#334155;margin-bottom:.25rem}
    .inp{width:100%;border:1px solid #cbd5e1;border-radius:.5rem;padding:.5rem .75rem}
    .card{background:#f8fafc;border:1px dashed #cbd5e1;border-radius:.75rem}
    .dashed.card{border-style:dashed}
    .btn-primary{background:#2563eb;color:#fff;padding:.55rem 1rem;border-radius:.5rem}
    .btn-secondary{background:#e2e8f0;color:#111827;padding:.55rem 1rem;border-radius:.5rem}
    .btn-success{background:#22c55e;color:#fff;padding:.4rem .75rem;border-radius:.35rem}
    .btn-subtle{background:#e2e8f0;color:#0f172a;padding:.35rem .6rem;border-radius:.35rem}
    .help{font-size:.75rem;color:#94a3b8;margin-top:.25rem}
    /* Tarjetas de Sustento */
    .doc-card{background:#f8fafc;border:2px dashed #cbd5e1;border-radius:.75rem;padding:14px}
    .doc-card .doc-title{font-weight:600;color:#1f2937}
    .doc-remove{background:#ef4444;color:#fff;border-radius:.35rem;padding:.15rem .45rem;font-size:.75rem}
    .dz-select{display:flex;align-items:center;gap:.5rem}
    .dz-btn{font-weight:600}
    .file-chip{display:inline-flex;align-items:center;gap:.35rem;margin:.25rem .45rem .25rem 0;padding:.15rem .5rem;border:1px solid #cbd5e1;border-radius:.5rem;background:#fff;font-size:.75rem}
    .file-chip .x{cursor:pointer;color:#ef4444;font-weight:700}
    .doc-tag{display:inline-flex;align-items:center;gap:.35rem;margin:.25rem .45rem .25rem 0;padding:.2rem .5rem;border:1px solid #cbd5e1;border-radius:.5rem;background:#fff;font-size:.75rem}
    .doc-tag .x{cursor:pointer;color:#ef4444;font-weight:700}

      .oc-confirm-card{background:#fff;border:1px solid #e5e7eb;border-radius:.75rem;padding:1rem;box-shadow:0 1px 2px rgba(0,0,0,.06)}
  .oc-confirm-card h2{font-size:1rem;font-weight:600;color:#1f2937;margin-bottom:.25rem}
  .oc-confirm-card p{font-size:.875rem;color:#475569}
  .oc-confirm-card .fecha{font-weight:600;color:#0f172a}
  </style>
    <link rel="stylesheet" href="css/back-office-ope-camb.css">
</head>
<body class="bg-gray-100 text-slate-800">
  <div id="area-badge"
     style="position: absolute; top: 15px; right: 20px;
            background-color: #1e6ba8; color: #fff;
            font-weight: bold; font-size: 0.9rem;
            padding: 6px 14px; border-radius: 20px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.15);">
  Área: -
</div>
  <main class="max-w-screen-xl mx-auto px-4 py-6">
    <div class="header rounded-2xl rounded-b-none">
      <h1>Operación Cambiaria</h1>
    </div>

    <section class="bg-white rounded-2xl rounded-t-none border border-gray-200 shadow">
      <!-- Tabs -->
      <div class="oc-tabs px-4 pt-4">
        <div class="oc-tablist" role="tablist" aria-label="Tabs Operación cambiaria">
          <!-- tabs de transferencias se inyectan antes -->
          <span id="oc-tab-dynamic"></span>
         <button class="oc-tab is-active"
        role="tab" aria-selected="true"
        aria-controls="tab-operacion"
        id="tabbtn-operacion"
        data-tab="tab-operacion">Operación</button>
      </div>

      <!-- Panels -->
      <div class="oc-panels p-5">
        <!-- Operación -->
        <section id="tab-operacion" class="oc-panel is-active" role="tabpanel" aria-labelledby="tabbtn-operacion">
          <div class="section-header">1. Registro de Operación cambiaria</div>
          <form id="formOperacion" class="space-y-4" novalidate>
            <div class="dashed card p-4">
              <div class="grid md:grid-cols-6 gap-4">
                <div>
                  <label class="lbl">Moneda Origen</label>
                  <select id="oc_moneda_origen" class="inp">
                    <option value="PEN">PEN</option><option value="USD">USD</option>
                  </select>
                </div>
                <div class="md:col-span-2">
                  <label class="lbl">Importe Origen</label>
                  <input id="oc_importe_origen" type="text" class="inp" placeholder="100,000,000.00" inputmode="decimal">
                </div>
                <div>
                  <label class="lbl">Tipo de Cambio</label>
                  <input id="oc_tipo_cambio" type="text" class="inp" placeholder="3.454554" inputmode="decimal">
                </div>
                <div>
                  <label class="lbl">Moneda Destino</label>
                  <select id="oc_moneda_destino" class="inp">
                    <option value="USD">USD</option><option value="PEN">PEN</option>
                  </select>
                </div>
                <div>
                  <label class="lbl">Importe Destino</label>
                  <input id="oc_importe_destino" type="text" class="inp" placeholder="100,000,000.00" inputmode="decimal">
                </div>
              </div>

              <div class="grid md:grid-cols-2 gap-4 mt-3">
                <div>
                  <label class="lbl">Banco cuenta cargo</label>
                  <select id="oc_banco_cargo" class="sel2" style="width:100%"></select>
                </div>
                <div>
                  <label class="lbl">Nro Cuenta Bancaria</label>
                  <select id="oc_cuenta_cargo" class="sel2" style="width:100%"></select>
                </div>
              </div>

              <div class="grid md:grid-cols-2 gap-4 mt-3">
                <div>
                  <label class="lbl">Banco cuenta destino</label>
                  <select id="oc_banco_destino" class="sel2" style="width:100%"></select>
                </div>
                <div>
                  <label class="lbl">Nro Cuenta Destino</label>
                  <select id="oc_cuenta_destino" class="sel2" style="width:100%"></select>
                </div>
              </div>

              <div class="grid md:grid-cols-3 gap-4 mt-3">
                <div>
                  <label class="lbl">Fecha de cambio</label>
                  <input id="oc_fecha" type="date" class="inp">
                </div>
              </div>
            </div>

            <!-- Comisión global -->
            <div class="subsection">
              <div class="section-header">2. Registro de la comisión</div>
              <div class="grid gap-4 md:grid-cols-3">
                <div>
                  <label class="lbl">Fondo solicitado</label>
                  <input id="oc_fondo" type="text" class="inp" placeholder="150,000,000" inputmode="decimal">
                </div>
                <div>
                  <label class="lbl">Comisión</label>
                  <input id="oc_comision" type="text" class="inp" placeholder="Ej. 20.70" inputmode="decimal">
                </div>
                <div>
                  <label class="lbl">Total</label>
                  <input id="oc_total" type="text" class="inp" placeholder="150,000,000" inputmode="decimal" readonly>
                </div>
              </div>
            </div>

            <!-- Sustento global -->
            <div class="subsection">
              <div class="section-header">3. Sustento Documentario</div>
              <!-- Card de confirmación / última carta (OPERACIÓN) -->
              <div id="oc_card_operation_confirm" class="my-4"></div>
              <!-- Grilla de tarjetas (Riesgos, Legal, Acta + extras) -->
              <div id="oc_docs_grid" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6"></div>

              <div class="mt-5">
                <div class="flex items-center gap-2 text-slate-700 font-medium mb-1">
                  <span class="select-none">🛠</span> Configuración avanzada
                </div>
                <p class="text-xs text-slate-500 mb-2">Agregue documentos adicionales para el área seleccionada:</p>
                <div class="flex gap-2">
                  <input type="text" id="oc_doc_nombre" class="inp flex-1" placeholder="Nombre del nuevo documento">
                  <button type="button" id="oc_btn_add_doc" class="btn-success">+ Agregar Documento</button>
                </div>
              </div>
            </div>

            <div class="flex justify-end gap-3 pt-3">
              <button type="button" id="btnCancelar" class="btn-secondary">Cancelar</button>
              <button type="button" id="btnGenerarCarta" class="btn-secondary">Generar Carta</button>
              <button type="submit" id="btnInstruir" class="btn-primary">Confirmar</button>
            </div>
          </form>
        </section>

        <!-- aquí se montan los paneles de transferencias -->
        <div id="transfer-panels"></div>
      </div>
    </section>

    <!-- TEMPLATE transferencia -->
    <template id="tplTransferencia">
      <section class="oc-panel">
        <div class="flex items-center justify-between">
           <div class="section-header w-full trf-title">1. Información de la transferencia #<span class="num">1</span></div>
        </div>

        <div class="card p-4">
          <div class="grid gap-4 md:grid-cols-3">
            <div>
              <label class="lbl">Moneda</label>
              <select class="inp sel-moneda">
                <option value="PEN">PEN</option><option value="USD">USD</option>
              </select>
            </div>
            <div>
              <label class="lbl">Monto</label>
              <input type="text" class="inp txt-monto" placeholder="Ej. 1,310,067.70" inputmode="decimal">
            </div>
            <div>
              <label class="lbl">Fecha de confirmación de la transferencia</label>
              <input type="date"
                   value="2025-10-14" class="inp inp-fecha" >
            </div>
          </div>

          <div class="grid gap-4 md:grid-cols-2 mt-3">
            <div>
              <label class="lbl">Banco cuenta de cargo</label>
              <select class="sel2 sel-banco-cargo" style="width:100%"></select>
              <p class="help">Selecciona el banco desde donde se realizará el aporte.</p>
            </div>
            <div>
              <label class="lbl">Nro cuenta bancaria</label>
              <select class="sel2 sel-cuenta-cargo" style="width:100%"></select>
              <p class="help">Selecciona la cuenta desde donde se realizará el aporte.</p>
            </div>
          </div>

          <div class="grid gap-4 md:grid-cols-2 mt-3">
            <div>
              <label class="lbl">Banco cuenta destino</label>
              <select class="sel2 sel-banco-destino" style="width:100%"></select>
              <p class="help">Selecciona el banco destino del aporte.</p>
            </div>
            <div>
              <label class="lbl">Nro cuenta destino</label>
              <select class="sel2 sel-cuenta-destino" style="width:100%"></select>
            </div>
          </div>
        </div>

        <!-- Comisión transferencia -->
        <div class="subsection">
             <div class="section-header">2. Registro de la comisión</div>
          <div class="grid gap-4 md:grid-cols-3">
            <div>
              <label class="lbl">Fondo solicitado</label>
              <input type="text" class="inp trf-fondo" placeholder="150,000,000" inputmode="decimal">
            </div>
            <div>
              <label class="lbl">Comisión</label>
              <input type="text" class="inp trf-comision" placeholder="Ej. 20.70" inputmode="decimal">
            </div>
            <div>
              <label class="lbl">Total</label>
              <input type="text" class="inp trf-total" placeholder="150,000,000" inputmode="decimal" readonly>
            </div>
          </div>
        </div>

        <!-- Sustento transferencia -->
        <div class="subsection">
         <div class="section-header">3. Sustento documentario</div>
         <!-- Card de confirmación / última carta (TRANSFERENCIA) -->
        <div class="oc_card_transfer_confirm my-4"></div>
          <div class="trf-docs-grid grid md:grid-cols-2 lg:grid-cols-3 gap-6"></div>

          <div class="mt-5">
            <div class="flex items-center gap-2 text-slate-700 font-medium mb-1">
              <span class="select-none">🛠</span> Configuración avanzada
            </div>
            <p class="text-xs text-slate-500 mb-2">Agregue documentos adicionales para el área seleccionada:</p>
            <div class="flex gap-2">
              <input type="text" class="inp flex-1 trf-doc-nombre" placeholder="Nombre del nuevo documento">
              <button type="button" class="btn-success trf-btn-add-doc">+ Agregar Documento</button>
            </div>
          </div>
        </div>

        <div class="flex justify-end gap-3 mt-4">
          <button type="button" class="btn-secondary trf-btn-carta">Generar Carta</button>
          <button type="button" class="btn-primary trf-btn-confirmar">Confirmar</button>
        </div>
      </section>
    </template>
  </main>
  <div id="pdfModal" class="fixed inset-0 bg-black/60 hidden items-center justify-center z-50">
  <div class="bg-white w-[90vw] h-[85vh] rounded-lg shadow-lg overflow-hidden flex flex-col">
    <div class="p-3 border-b flex items-center justify-between">
      <h3 class="font-semibold">Vista previa PDF consolidado</h3>
      <div class="flex items-center gap-2">
        <a id="btnDescargarPdf" href="#" download="instrucciones_consolidado.pdf"
           class="px-2 py-1 bg-green-600 hover:bg-green-700 text-white rounded text-sm">Descargar</a>
        <button id="btnCerrarModal" class="px-2 py-1 rounded border">Cerrar</button>
      </div>
    </div>
    <div class="flex-1">
      <iframe id="pdfViewer" style="width:100%; height:100%; border:0;"></iframe>
    </div>
  </div>
</div>

  <script src="js/back-office-ope-camb.js"></script>
</body>
</html>
